<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Feature flags in GitLab | Mikhail Potter</title>
<meta name="title" content="Feature flags in GitLab" />
<meta name="description" content="Feature flag is a concept that allows to enable and disable features without the need to redeploy application. They provide much flexible way to manage features’ lifecycle. With feature flags you would have the following advantages:
Features can be released for a subset of users to minimise risk of bugs and errors that affect a lot of users or apply A/B testing Allow to continuously integrate and deploy features without affecting user experience (you can get rid of long lived feature branches) Changes can be rolled back easily without application redeployment However, along with advantages you usually get a set of trade offs:" />
<meta name="keywords" content="GitLab,CI,Feature Flags," />


<meta property="og:title" content="Feature flags in GitLab" />
<meta property="og:description" content="Feature flag is a concept that allows to enable and disable features without the need to redeploy application. They provide much flexible way to manage features’ lifecycle. With feature flags you would have the following advantages:
Features can be released for a subset of users to minimise risk of bugs and errors that affect a lot of users or apply A/B testing Allow to continuously integrate and deploy features without affecting user experience (you can get rid of long lived feature branches) Changes can be rolled back easily without application redeployment However, along with advantages you usually get a set of trade offs:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mvpotter.github.io/mvpotter/blog/2023/03/feature-flags-in-gitlab/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-03-24T18:03:14+07:00" />
<meta property="article:modified_time" content="2023-03-24T18:03:14+07:00" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Feature flags in GitLab"/>
<meta name="twitter:description" content="Feature flag is a concept that allows to enable and disable features without the need to redeploy application. They provide much flexible way to manage features’ lifecycle. With feature flags you would have the following advantages:
Features can be released for a subset of users to minimise risk of bugs and errors that affect a lot of users or apply A/B testing Allow to continuously integrate and deploy features without affecting user experience (you can get rid of long lived feature branches) Changes can be rolled back easily without application redeployment However, along with advantages you usually get a set of trade offs:"/>



<meta itemprop="name" content="Feature flags in GitLab">
<meta itemprop="description" content="Feature flag is a concept that allows to enable and disable features without the need to redeploy application. They provide much flexible way to manage features’ lifecycle. With feature flags you would have the following advantages:
Features can be released for a subset of users to minimise risk of bugs and errors that affect a lot of users or apply A/B testing Allow to continuously integrate and deploy features without affecting user experience (you can get rid of long lived feature branches) Changes can be rolled back easily without application redeployment However, along with advantages you usually get a set of trade offs:"><meta itemprop="datePublished" content="2023-03-24T18:03:14+07:00" />
<meta itemprop="dateModified" content="2023-03-24T18:03:14+07:00" />
<meta itemprop="wordCount" content="614">
<meta itemprop="keywords" content="GitLab,CI,Feature Flags," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: Verdana, sans-serif;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #333;
      color: #ddd;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    strong,
    b {
      color: #eee;
    }

    a {
      color: #8cc2dd;
    }

    code {
      background-color: #777;
    }

    pre code {
      color: #ddd;
    }

    blockquote {
      color: #ccc;
    }

    textarea,
    input {
      background-color: #252525;
      color: #ddd;
    }

    .helptext {
      color: #aaa;
    }
  }

</style>

</head>

<body>
  <header><a href="/mvpotter/" class="title">
  <h2>Mikhail Potter</h2>
</a>
<nav>
<a href="/mvpotter/">Blog</a>

<a href="/mvpotter/cv.pdf">CV</a>

<a href="https://www.linkedin.com/in/supermegapotter">Linkedin</a>

<a href="https://github.com/mvpotter">GitHub</a>

<a href="https://medium.com/@supermegapotter">Medium</a>

</nav>
</header>
  <main>

<h1>Feature flags in GitLab</h1>
<p>
  <i>
    <time datetime='2023-03-24' pubdate>
      24 Mar, 2023
    </time>
  </i>
</p>

<content>
  <p>Feature flag is a concept that allows to enable and disable features without the need to redeploy application. They provide much flexible way to manage features’ lifecycle. With feature flags you would have the following advantages:</p>
<ul>
<li>Features can be released for a subset of users to minimise risk of bugs and errors that affect a lot of users or apply A/B testing</li>
<li>Allow to continuously integrate and deploy features without affecting user experience (you can get rid of long lived feature branches)</li>
<li>Changes can be rolled back easily without application redeployment</li>
</ul>
<p>However, along with advantages you usually get a set of trade offs:</p>
<ul>
<li>Feature flags add complexity to a code base</li>
<li>They create technical debt as flags and old logic should be removed after a while</li>
<li>Require much discipline and effort from developers and QAs to maintain related logic and ensuring that necessary flags are enabled on required platforms</li>
</ul>
<p>There are a number of solutions for feature flags management like <a href="https://flagsmith.com/">FlagSmith</a>, <a href="https://www.growthbook.io/">GrowthBook</a>, <a href="https://www.flipt.io/">Flipt</a>, <a href="https://www.getunleash.io/">Unleash</a> and others. However, if you already use GitLab, you can use its <a href="https://docs.gitlab.com/ee/operations/feature_flags.html">feature flags</a> feature. Since version 13.5 GitLab is integrated with <a href="https://www.getunleash.io/">Unleash</a> and provides both UI and API for feature flags management.</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*q-9flWSEmJ895KjuHJvGvQ.png" alt=""></p>
<p>In the <strong>Feature Flags</strong> section of GitLab UI you can create feature flags and enable them either for all or specific environments and users.</p>
<p>To integrate an application with the API it is necessary to click <strong>Configure</strong> and copy <em>API URL</em> and <em>Instance ID</em>. The following example code would be in Java, but any backend can be integrated with it. <a href="https://www.getunleash.io/">Unleash</a> has SDKs for all popular stacks.</p>
<p>The first step is to add SDK dependency to the project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>io.getunleash<span style="color:#f92672">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>unleash-client-java<span style="color:#f92672">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>Latest version here<span style="color:#f92672">&lt;/version&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>Then it is necessary to put <em>API URL</em> and <em>Instance ID</em> to properties. Here <em>unleash.env</em> set additionally. It allows application to be aware on which environment it was launched. So we can turn a feature on or off for it.</p>
<pre tabindex="0"><code>unleash:   
  url: https://gitlab.noveogroup.com/api/v4/feature_flags/unleash/4321   
  key: SDFasfsfasfdFDsafD   
  env: localya
</code></pre><p>Then we define Unleash bean with the parameters above. Using <em>UnleashConfig</em> it is possible to configure other useful parameters, e.g. default value in case feature flag does not exist, or delay for a client to fetch actual flags’ state.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>   
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UnleashConfiguration</span> <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">@Bean</span>   
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span> Unleash <span style="color:#a6e22e">unleash</span><span style="color:#f92672">(</span>   
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">@Value</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;${unleash.url}&#34;</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">final</span> String url<span style="color:#f92672">,</span>   
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">@Value</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;${unleash.key}&#34;</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">final</span> String instanceId<span style="color:#f92672">,</span>   
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">@Value</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;${unleash.env}&#34;</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">final</span> String env   
</span></span><span style="display:flex;"><span> <span style="color:#f92672">)</span> <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DefaultUnleash<span style="color:#f92672">(</span>   
</span></span><span style="display:flex;"><span>     UnleashConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>   
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">.</span><span style="color:#a6e22e">unleashAPI</span><span style="color:#f92672">(</span>url<span style="color:#f92672">)</span>   
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">.</span><span style="color:#a6e22e">instanceId</span><span style="color:#f92672">(</span>instanceId<span style="color:#f92672">)</span>   
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">.</span><span style="color:#a6e22e">appName</span><span style="color:#f92672">(</span>env<span style="color:#f92672">)</span>   
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">()</span>   
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">);</span>   
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Now lets define some feature flag. Actually, feature flag is defined by its name. However, for the sake of type safety let store it as enum.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Getter</span>   
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">enum</span> FeatureToggleType <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  AWESOME_FEATURE<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;awesome-feature&#34;</span><span style="color:#f92672">);</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> String code<span style="color:#f92672">;</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  FeatureToggleType<span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String code<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> code<span style="color:#f92672">;</span>   
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>To fetch feature flag info from API we need appropriate class to put values into:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Getter</span>   
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Setter</span>   
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@NoArgsConstructor</span>   
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@AllArgsConstructor</span>   
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FeatureToggle</span> <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> enabled<span style="color:#f92672">;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>And define a service that can check feature flag state or fetch a list of flags available for the current environment. Our application proxies requests to Unleash for frontend not to have additional dependencies. So, the latter method helps to provide necessary data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>   
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FeatureToggleService</span> <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Unleash unleash<span style="color:#f92672">;</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">FeatureToggleServiceImpl</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Unleash unleash<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">unleash</span> <span style="color:#f92672">=</span> unleash<span style="color:#f92672">;</span>   
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isEnabled</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> FeatureToggleType featureToggle<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> unleash<span style="color:#f92672">.</span><span style="color:#a6e22e">isEnabled</span><span style="color:#f92672">(</span>featureToggle<span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">());</span>   
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>FeatureToggle<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">list</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> unleash<span style="color:#f92672">.</span><span style="color:#a6e22e">more</span><span style="color:#f92672">().</span><span style="color:#a6e22e">evaluateAllToggles</span><span style="color:#f92672">().</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>   
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>toggle <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">new</span> FeatureToggle<span style="color:#f92672">(</span>toggle<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(),</span> toggle<span style="color:#f92672">.</span><span style="color:#a6e22e">isEnabled</span><span style="color:#f92672">()))</span>   
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">.</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>   
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>   
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>And the last step is to add condition to check feature flag and launch necessary logic:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>featureToggleServive<span style="color:#f92672">.</span><span style="color:#a6e22e">isEnabled</span><span style="color:#f92672">(</span>FeatureToggleType<span style="color:#f92672">.</span><span style="color:#a6e22e">AWESOME_FEATURE</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>  awesomeStrategy<span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">();</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>  
</span></span><span style="display:flex;"><span>  legacyStrategy<span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">();</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>GitLab feature flags work great for relatively small projects as it has its limitations. For bigger project you can use <a href="https://www.getunleash.io/">Unleash</a> directly. Fortunately, migration shouldn’t be that hard.</p>

</content>
<p>
  
  <a href="https://mvpotter.github.io/mvpotter/tags/gitlab/">#GitLab</a>
  
  <a href="https://mvpotter.github.io/mvpotter/tags/ci/">#CI</a>
  
  <a href="https://mvpotter.github.io/mvpotter/tags/feature-flags/">#Feature Flags</a>
  
</p>

  </main>
  <footer>Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo ʕ•ᴥ•ʔ Bear</a>
</footer>

    
</body>

</html>
